<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>topIDEB ‚Äî Leitura Cr√≠tica (EM)</title>
  <style>
    :root{
      --bg1:#eef6ff;
      --bg2:#fff5f5;
      --card:rgba(255,255,255,0.92);
      --ink:#20324a;
      --muted:#6e8096;
      --accent:#5a9bd8;
      --accent-2:#7fb7ff;
      --ok:#eaf3ff;
      --no:#ffefed;
      --warn:#e28989;
      --chip:rgba(255,255,255,0.65);
    }
    body{margin:0; font-family:Inter,system-ui,sans-serif; color:var(--ink); background:linear-gradient(135deg,var(--bg1),var(--bg2)); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px;}
    #app{ width:min(920px,100%); background:var(--card); border-radius:16px; box-shadow:0 10px 30px rgba(15,41,66,.12); overflow:hidden; }
    header{ padding:18px 20px; background:linear-gradient(180deg,rgba(240,248,255,0.88),rgba(255,255,255,0.78)); border-bottom:1px solid rgba(229,238,251,0.6); display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .brand{ display:flex; align-items:center; gap:12px; }
    .logo{ width:38px; height:38px; border-radius:10px; background:conic-gradient(from 210deg at 50% 50%, var(--accent), #b5d2f2, #ffdcdc, var(--accent));}
    .controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    input{padding:10px 12px; border:1px solid #cddff5; border-radius:10px; background:rgba(255,255,255,0.7);}
    button{cursor:pointer; border:none; border-radius:10px; padding:10px 14px; font-weight:600;}
    .primary{ background:var(--accent); color:#fff; }
    .ghost{ background:rgba(255,255,255,0.7); color:var(--accent); border:1px solid #cddff5 }
    .danger{ background:var(--warn); color:#fff }
    main{ padding:20px; display:grid; gap:16px; }
    .status{ display:grid; grid-template-columns:repeat(4,1fr); gap:10px; }
    .chip{ background:var(--chip); padding:10px 12px; border-radius:999px; font-size:.88rem; text-align:center; border:1px solid #cddff5;}
    .card{ background:rgba(255,255,255,0.92); border:1px solid #d7e4f7; border-radius:14px; padding:16px; }
    .question{ font-weight:700; margin:12px 0 6px; font-size:1.05rem; }
    .subtitle{ font-size:.95rem; margin-bottom:8px; }
    .answers{ display:grid; gap:10px; margin-top:10px }
    .ans{ text-align:left; padding:14px 16px; border:2px solid #d7e4f7; background:rgba(255,255,255,0.9); border-radius:12px; }
    .ans.ok{ background:var(--ok); border-color:#a8c7ff }
    .ans.no{ background:var(--no); border-color:#ffb5ae }
    .explain{ margin-top:10px; font-size:1rem; background:rgba(242,248,255,0.94); border:1px solid #cddff5; border-radius:10px; padding:12px; display:none }
    .footer{ display:flex; gap:10px; justify-content:space-between; }
    .hidden{display:none!important}
  </style>
</head>
<body>
  <div id="app">
    <header>
      <div class="brand"><div class="logo"></div><h1>topIDEB</h1></div>
      <div class="controls">
        <input id="student" type="text" placeholder="Nome do(a) aluno(a)" />
        <button id="start" class="primary">Come√ßar</button>
        <button id="restart" class="ghost hidden">Reiniciar</button>
      </div>
    </header>

    <main>
      <section class="status">
        <div class="chip">Pontua√ß√£o: <strong id="score">0</strong></div>
        <div class="chip">Vidas: <strong id="lives">‚ù§‚ù§‚ù§</strong></div>
        <div class="chip">Tempo: <strong id="time">‚Äì</strong></div>
        <div class="chip">Ranking</div>
      </section>

      <div class="card">
        <div id="context">Digite o nome e clique em <strong>Come√ßar</strong>. O jogo ter√° 3 fases: F√°cil, M√©dia e Dif√≠cil (8 quest√µes cada).</div>
        <div id="question" class="question"></div>
        <div id="descriptor" class="subtitle"></div>
        <div id="answers" class="answers"></div>
        <div id="explain" class="explain"></div>
        <div class="footer">
          <div id="progress"></div>
          <div><button id="saveScore" class="ghost hidden">Salvar</button><button id="resetRanking" class="danger">Zerar</button></div>
        </div>
      </div>

      <div class="card"><ul id="ranking"></ul></div>
    </main>
  </div>

<script>
/* ==============================
   topIDEB ‚Äî 3 fases (F√°cil, M√©dia, Dif√≠cil), 8 quest√µes cada
   ============================== */

// Exemplo de banco resumido (adicione mais quest√µes depois para chegar a 50+)
const PHASES = [
  { name:'F√°cil', items:[
    {desc:{code:'D1',text:'Localizar informa√ß√µes expl√≠citas'}, ctx:'"O campeonato come√ßa dia 12 de maio."', q:'Qual a data de in√≠cio?', a:['10 de maio','12 de maio','15 de maio','20 de maio'], c:1, e:'Informa√ß√£o literal: 12 de maio.'},
    {desc:{code:'D4',text:'Inferir informa√ß√µes impl√≠citas'}, ctx:'Jo√£o saiu com guarda-chuva ao ver o c√©u nublado.', q:'O que se infere?', a:['Vai ventar','Pode chover','Vai fazer sol','Haver√° neblina'], c:1, e:'Guarda-chuva + nublado ‚Üí chance de chuva.'},
    {desc:{code:'D14',text:'Diferenciar fato de opini√£o'}, ctx:'"A biblioteca recebeu 200 livros."', q:'Qual op√ß√£o √© fato?', a:['A biblioteca ficou incr√≠vel','Chegaram 200 livros','Os livros s√£o √≥timos','Foi um exagero'], c:1, e:'Dado verific√°vel: 200 livros.'},
    {desc:{code:'D8',text:'Identificar argumenta√ß√£o'}, ctx:'"Devemos plantar √°rvores, pois reduzem o calor."', q:'Qual √© o argumento?', a:['Plantar √°rvores','Reduzem o calor','A cidade √© quente','Pra√ßas s√£o bonitas'], c:1, e:'A raz√£o √© reduzir o calor.'}
  ]},
  { name:'M√©dia', items:[
    {desc:{code:'D4',text:'Inferir informa√ß√µes impl√≠citas'}, ctx:'Carlos chegou encharcado e deixou o casaco secando.', q:'Prov√°vel causa:', a:['Neve','Chuva','Calor','Vento'], c:1, e:'Encharcado ‚Üí chuva.'},
    {desc:{code:'D8',text:'Identificar argumenta√ß√£o'}, ctx:'"O uso de bicicletas deve ser incentivado porque diminui o tr√¢nsito."', q:'Qual √© a tese?', a:['Diminuir o tr√¢nsito','Incentivar bicicletas','Carros poluem','Ciclovias s√£o caras'], c:1, e:'Tese: incentivar bicicletas.'}
  ]},
  { name:'Dif√≠cil', items:[
    {desc:{code:'D8',text:'Identificar argumenta√ß√£o'}, ctx:'"A coleta seletiva deve ser obrigat√≥ria; assim, diminuiremos o lixo nos aterros."', q:'Qual √© a tese?', a:['Diminuir o lixo','Obrigatoriedade da coleta seletiva','Pessoas reciclam pouco','Aterros s√£o caros'], c:1, e:'Tese: tornar obrigat√≥ria.'},
    {desc:{code:'D14',text:'Diferenciar fato de opini√£o'}, ctx:'"A feira recebeu 5.000 visitantes; foi a melhor de todas."', q:'Qual √© fato?', a:['Foi a melhor de todas','Recebeu 5.000 visitantes','Todos adoraram','Organiza√ß√£o perfeita'], c:1, e:'N√∫mero verific√°vel.'}
  ]}
];

const QUESTIONS_PER_PHASE = 8; 
const MAX_LIVES = 3, TIME = 40;
let phase = 0, pool = [], asked = 0, lives = MAX_LIVES, score = 0, timer = null, timeLeft = TIME;

const $ = s => document.querySelector(s);
const el = { student:$('#student'), start:$('#start'), restart:$('#restart'), score:$('#score'), lives:$('#lives'), time:$('#time'), context:$('#context'), question:$('#question'), descriptor:$('#descriptor'), answers:$('#answers'), explain:$('#explain'), progress:$('#progress'), saveScore:$('#saveScore'), ranking:$('#ranking'), resetRanking:$('#resetRanking') };

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a }
function fmtHearts(n){ return '‚ù§'.repeat(n) }
function calcPoints(t){ return t>=30?100:t>=20?70:t>=10?40:10 }

function buildPool(phaseObj){
  const all = phaseObj.items.map((_,qi)=>({phase:phase, qi}));
  return shuffle(all).slice(0, Math.min(QUESTIONS_PER_PHASE, phaseObj.items.length));
}

function tick(startAt){
  timeLeft = startAt; el.time.textContent = timeLeft+'s';
  clearInterval(timer);
  timer = setInterval(()=>{ timeLeft--; el.time.textContent=timeLeft+'s'; if(timeLeft<=0){ clearInterval(timer); answer(null,false); } },1000);
}

function start(){
  const name = el.student.value.trim();
  if(!name){ alert('Digite o nome do(a) aluno(a).'); return; }
  phase = 0; lives = MAX_LIVES; score = 0; asked = 0; pool = buildPool(PHASES[phase]);
  el.lives.textContent = fmtHearts(lives); el.score.textContent = score; el.explain.style.display='none';
  el.restart.classList.add('hidden'); el.saveScore.classList.add('hidden');
  next();
}

function next(){
  clearInterval(timer);
  if(lives<=0){ return end(); }
  if(asked>=pool.length){
    phase++;
    if(phase>=PHASES.length){ return end(); }
    alert(`üéâ Fase conclu√≠da! Avan√ßando para a fase ${PHASES[phase].name}.`);
    asked = 0; pool = buildPool(PHASES[phase]);
  }
  const pick = pool[asked++];
  const item = PHASES[phase].items[pick.qi];

  el.context.textContent = item.ctx;
  el.question.textContent = item.q;
  el.descriptor.innerHTML = `<strong>[${item.desc.code}] ${item.desc.text}</strong>`;
  el.explain.textContent = ''; el.explain.style.display = 'none';

  el.answers.innerHTML = '';
  const opts = shuffle(item.a.map((t,i)=>({t,i})));
  for(const opt of opts){
    const b = document.createElement('button');
    b.className = 'ans'; b.type = 'button'; b.textContent = opt.t;
    b.addEventListener('click',()=>answer(b, opt.i===item.c, item));
    el.answers.appendChild(b);
  }
  el.progress.textContent = `Fase ${phase+1}/${PHASES.length} ¬∑ Quest√£o ${asked} de ${pool.length}`;
  tick(TIME);
}

function answer(btn, ok, item){
  clearInterval(timer);
  Array.from(el.answers.children).forEach(b=> b.disabled=true);
  if(btn) btn.classList.add(ok?'ok':'no');
  if(ok){ score += calcPoints(timeLeft); el.score.textContent = score; } else { lives--; el.lives.textContent = fmtHearts(lives); }
  el.explain.textContent = (ok?'Acertou! ':'N√£o foi dessa vez. ') + (item?.e || '');
  el.explain.style.display = 'block';
  setTimeout(next, 900);
}

function end(){
  clearInterval(timer);
  el.context.innerHTML = `<strong>Fim!</strong> Voc√™ concluiu todas as fases com pontua√ß√£o ${score}.`;
  el.question.textContent=''; el.descriptor.textContent='';
  el.answers.innerHTML=''; el.explain.style.display='none'; el.progress.textContent='';
  el.restart.classList.remove('hidden'); el.saveScore.classList.remove('hidden');
}

// Ranking
el.saveScore.addEventListener('click', ()=>{
  const name = el.student.value.trim();
  if(!name){ alert('Sem nome n√£o d√° pra salvar üòÖ'); return; }
  const data = JSON.parse(localStorage.getItem('rank_idedb_em'))||[];
  data.push({ name, score, at:new Date().toISOString() });
  data.sort((a,b)=> b.score - a.score);
  localStorage.setItem('rank_idedb_em', JSON.stringify(data.slice(0,20)));
  el.saveScore.classList.add('hidden');
  renderRanking();
});

function renderRanking(){
  const data=JSON.parse(localStorage.getItem('rank_idedb_em'))||[];
  el.ranking.innerHTML = data.map((r,i)=>`<li>${i+1}. ${escapeHtml(r.name)} ‚Äî <strong>${r.score}</strong> pts</li>`).join('');
}
function escapeHtml(s){ return String(s).replace(/[&<>\"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])) }

// Init
document.getElementById('start').addEventListener('click', start);
document.getElementById('restart').addEventListener('click', start);
document.getElementById('resetRanking').addEventListener('click', ()=>{ localStorage.removeItem('rank_idedb_em'); renderRanking(); alert('Ranking zerado!'); });
renderRanking();
</script>
</body>
</html>
